<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
  <body>
    <div th:fragment="content">
      <main class="rbt-main-wrapper">
        <div class="rbt-create-course-area bg-color-white rbt-section-gap">
          <div class="container">
            <div class="row g-5">
              <div class="col-lg-8">
                <form
                  id="create-course-form"
                  th:action="@{/instructor/update-course}"
                  th:object="${course}"
                  method="post"
                  enctype="multipart/form-data"
                >
                  <div class="rbt-accordion-style rbt-accordion-01 rbt-accordion-06 accordion">
                    <div class="accordion" id="tutionaccordionExamplea1">
                      <!-- Th√¥ng tin c∆° b·∫£n kh√≥a h·ªçc -->
                      <div th:replace="~{client/course/course-info :: course-info}"></div>

                      <!-- C√°c ch∆∞∆°ng, b√†i h·ªçc v√† t√†i li·ªáu -->
                      <div th:replace="~{client/course/course-builder :: course-builder}"></div>
                    </div>
                  </div>

                  <div class="mt--10 row g-5 d-flex justify-content-end">
                    <div class="col-lg-6" th:if="${course.status == 'draft'}">
                      <a
                        class="rbt-btn hover-icon-reverse bg-primary-opacity w-100 text-center"
                        th:href="@{/instructor/request-approve-course/{id}(id=${course.courseId})}"
                        onclick="return confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën g·ª≠i y√™u c·∫ßu ph√™ duy·ªát kh√≥a h·ªçc n√†y kh√¥ng?')"
                      >
                        <span class="icon-reverse-wrapper">
                          <span class="btn-text">Y√™u c·∫ßu ph√™ duy·ªát</span>
                          <span class="btn-icon"><i class="feather-send"></i></span>
                          <span class="btn-icon"><i class="feather-send"></i></span>
                        </span>
                      </a>
                    </div>
                    <div class="col-lg-6" th:if="${course.status == 'pending'}">
                      <a class="rbt-btn bg-secondary w-100 text-center">
                        <span class="btn-text">ƒêang ch·ªù ph√™ duy·ªát</span>
                        <span class="btn-icon"><i class="feather-clock"></i></span>
                      </a>
                    </div>
                    <div class="col-lg-12" th:if="${course.status == 'publish'}">
                      <a class="rbt-btn bg-success w-100 text-center">
                        <span class="btn-text">Kh√¥ng th·ªÉ ch·ªânh s·ª≠a khi kh√≥a h·ªçc ƒë√£ ƒë∆∞·ª£c c√¥ng khai</span>
                        <span class="btn-icon"><i class="feather-check-circle"></i></span>
                      </a>
                    </div>
                    <div class="col-lg-6" th:if="${course.status == 'hidden'}">
                      <a class="rbt-btn bg-danger w-100 text-center">
                        <span class="btn-text">ƒêang b·ªã ·∫©n</span>
                        <span class="btn-icon"><i class="feather-eye-off"></i></span>
                      </a>
                    </div>
                    <div class="col-lg-6" th:unless="${course.status == 'publish'}">
                      <!-- D·ªØ li·ªáu course, file image, file attachments g·ª≠i v·ªÅ backend d∆∞·ªõi d·∫°ng JSON -->
                      <input type="hidden" name="courseJson" id="courseJson" />
                      <input type="hidden" name="_method" value="put" />
                      <button type="submit" class="rbt-btn btn-gradient hover-icon-reverse w-100 text-center">
                        <span class="icon-reverse-wrapper">
                          <span class="btn-text">L∆∞u kh√≥a h·ªçc</span>
                          <span class="btn-icon"><i class="feather-arrow-right"></i></span>
                          <span class="btn-icon"><i class="feather-arrow-right"></i></span>
                        </span>
                      </button>
                    </div>
                  </div>
                </form>

                <br />
                <div class="col-lg-12">
                  <form
                    th:action="@{/instructor/clone-course}"
                    onsubmit="return confirm('B·∫°n c√≥ mu·ªën t·∫°o b·∫£n sao kh√¥ng?')"
                    method="post"
                  >
                    <input type="hidden" name="courseId" th:value="${course.courseId}" />
                    <button type="submit" class="rbt-btn bg-info w-100 text-center">
                      <span class="btn-text">T·∫°o b·∫£n sao</span>
                      <span class="btn-icon"><i class="feather-copy"></i></span>
                    </button>
                  </form>
                </div>
              </div>

              <div class="col-lg-4">
                <div class="rbt-create-course-sidebar course-sidebar sticky-top rbt-shadow-box rbt-gradient-border">
                  <div class="inner">
                    <div class="section-title mb--30">
                      <h4 class="title">M·∫πo T·∫£i L√™n Kh√≥a H·ªçc</h4>
                    </div>
                    <div class="rbt-course-upload-tips">
                      <ul class="rbt-list-style-1">
                        <li><i class="feather-check"></i> ƒê·∫∑t gi√° cho kh√≥a h·ªçc ho·∫∑c ƒë·ªÉ mi·ªÖn ph√≠.</li>
                        <li><i class="feather-check"></i> K√≠ch th∆∞·ªõc chu·∫©n cho ·∫£nh ƒë·∫°i di·ªán kh√≥a h·ªçc l√† 700x430.</li>
                        <li><i class="feather-check"></i> Ph·∫ßn video ƒëi·ªÅu khi·ªÉn video t·ªïng quan v·ªÅ kh√≥a h·ªçc.</li>
                        <li>
                          <i class="feather-check"></i> Tr√¨nh t·∫°o kh√≥a h·ªçc l√† n∆°i b·∫°n t·∫°o v√† s·∫Øp x·∫øp n·ªôi dung kh√≥a h·ªçc.
                        </li>
                        <li>
                          <i class="feather-check"></i> Th√™m c√°c ch·ªß ƒë·ªÅ trong ph·∫ßn Tr√¨nh t·∫°o kh√≥a h·ªçc ƒë·ªÉ t·∫°o b√†i h·ªçc,
                          b√†i ki·ªÉm tra v√† b√†i t·∫≠p.
                        </li>
                        <li>
                          <i class="feather-check"></i> Y√™u c·∫ßu ti√™n quy·∫øt l√† c√°c kh√≥a h·ªçc c∆° b·∫£n c·∫ßn ho√†n th√†nh tr∆∞·ªõc
                          khi h·ªçc kh√≥a n√†y.
                        </li>
                        <li>
                          <i class="feather-check"></i> Th√¥ng tin t·ª´ ph·∫ßn D·ªØ li·ªáu b·ªï sung s·∫Ω hi·ªÉn th·ªã tr√™n trang chi
                          ti·∫øt kh√≥a h·ªçc.
                        </li>
                        <li><i class="feather-check"></i> Dung l∆∞·ª£ng t·ªëi ƒë√£ m·ªói file l√† 10 mb.</li>
                        <li><i class="feather-check"></i> T·ªïng dung l∆∞·ª£ng t·ªëi ƒëa c√°c file t·∫£i l√™n l√† 100 mb</li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div th:replace="~{client/course/module-model :: module-model}"></div>

        <div th:replace="~{client/course/lesson-model :: lesson-model}"></div>

        <div th:replace="~{client/course/quiz-model :: quiz-model}"></div>

        <div class="rbt-separator-mid">
          <div class="container">
            <hr class="rbt-separator m-0" />
          </div>
        </div>
      </main>
    </div>

    <th:block th:fragment="scripts">
      <script th:src="@{/assets/js/course.js}"></script>
      <script th:src="@{/assets/js/module.js}"></script>
      <script th:src="@{/assets/js/lesson.js}"></script>
      <script th:src="@{/assets/js/quiz.js}"></script>
      <script th:inline="javascript">
        /*<![CDATA[*/
        const courseData = /*[[${course}]]*/ {};

        // Ch·ªâ g√°n d·ªØ li·ªáu n·∫øu localStorage ch∆∞a c√≥ (t·ª©c l√† l·∫ßn ƒë·∫ßu load)
        if (!localStorage.getItem("modules")) {
          localStorage.setItem(
            "modules",
            JSON.stringify(
              courseData.modules.map((m) => ({
                moduleId: m.moduleId,
                moduleTitle: m.moduleTitle,
              }))
            )
          );
        }

        if (!localStorage.getItem("lecturesPerModule")) {
          localStorage.setItem(
            "lecturesPerModule",
            JSON.stringify(Object.fromEntries(courseData.modules.map((m, i) => [i, m.lectures])))
          );
        }

        if (!localStorage.getItem("quizzesPerModule")) {
          localStorage.setItem(
            "quizzesPerModule",
            JSON.stringify(Object.fromEntries(courseData.modules.map((m, i) => [i, m.quizzes])))
          );
        }

        // === TH√äM V√ÄO SAU C√ôNG ===
        modules = Storage.get("modules", []);
        lecturesPerModule = Storage.get("lecturesPerModule", {});
        quizzesPerModule = Storage.get("quizzesPerModule", {});
        /*]]>*/

        document.addEventListener("DOMContentLoaded", function () {
          const urlParams = new URLSearchParams(window.location.search);
          const cloneSuccess = urlParams.get("cloneSuccess");

          if (cloneSuccess === "true") {
            // Hi·ªÉn th·ªã th√¥ng b√°o th√†nh c√¥ng (c√≥ th·ªÉ d√πng toast, sweetalert2, ...)
            console.log("T·∫°o b·∫£n sao kh√≥a h·ªçc th√†nh c√¥ng");

            // V√≠ d·ª•: hi·ªÉn th·ªã toast ƒë∆°n gi·∫£n
            const toast = document.createElement("div");
            toast.textContent = "üéâ T·∫°o b·∫£n sao kh√≥a h·ªçc th√†nh c√¥ng!";
            toast.style.position = "fixed";
            toast.style.bottom = "20px";
            toast.style.right = "20px";
            toast.style.padding = "10px 15px";
            toast.style.backgroundColor = "#4CAF50";
            toast.style.color = "#fff";
            toast.style.borderRadius = "6px";
            toast.style.boxShadow = "0 0 10px rgba(0,0,0,0.2)";
            document.body.appendChild(toast);

            // T·ª± ƒë·ªông ·∫©n sau 3s
            setTimeout(() => {
              toast.remove();
            }, 3000);
          }
        });
      </script>
    </th:block>
  </body>
</html>
