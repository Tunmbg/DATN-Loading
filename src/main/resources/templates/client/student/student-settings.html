<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <body>
    <div th:fragment="content">
      <div class="rbt-page-banner-wrapper">
        <!-- Start Banner BG Image  -->
        <div class="rbt-banner-image"></div>
        <!-- End Banner BG Image  -->
      </div>

      <!-- Start Card Style -->
      <div class="rbt-dashboard-area rbt-section-overlayping-top rbt-section-gapBottom">
        <div class="container">
          <div class="row">
            <div class="col-lg-12">
              <!-- Start Dashboard Top  -->
              <div
                th:replace="~{client/instructor/instructor-banner :: instructor-banner}"
                sec:authorize="hasAnyRole('ROLE_INSTRUCTOR', 'ROLE_ADMIN')"
              ></div>
              <div
                th:replace="~{client/student/student-banner :: student-banner}"
                sec:authorize="hasRole('ROLE_STUDENT') and not hasAnyRole('ROLE_INSTRUCTOR', 'ROLE_ADMIN')"
              ></div>
              <!-- End Dashboard Top  -->

              <div class="row g-5">
                <div class="col-lg-3">
                  <!-- Dashboard Sidebar -->
                  <div th:replace="~{client/student/studentSidebar :: student-sidebar}"></div>
                </div>
                <div class="col-lg-9">
                  <!-- Start Instructor Profile  -->
                  <div class="rbt-dashboard-content bg-color-white rbt-shadow-box">
                    <div class="content">
                      <div class="section-title">
                        <h4 class="rbt-title-style-3">Cài đặt thông tin</h4>
                      </div>
                      <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>
                      <div th:if="${success}" class="alert alert-success" th:text="${success}"></div>
                      <div class="advance-tab-button mb--30">
                        <ul
                          class="nav nav-tabs tab-button-style-2 justify-content-start"
                          id="settinsTab-4"
                          role="tablist"
                        >
                          <li role="presentation">
                            <a
                              href="#"
                              class="tab-button"
                              id="profile-tab"
                              data-bs-toggle="tab"
                              data-bs-target="#profile"
                              role="tab"
                              aria-controls="profile"
                              aria-selected="true"
                            >
                              <span class="title">Thông tin cá nhân</span>
                            </a>
                          </li>
                          <li role="presentation">
                            <a
                              href="#"
                              class="tab-button"
                              id="password-tab"
                              data-bs-toggle="tab"
                              data-bs-target="#password"
                              role="tab"
                              aria-controls="password"
                              aria-selected="false"
                            >
                              <span class="title">Mật khẩu</span>
                            </a>
                          </li>
                        </ul>
                      </div>

                      <div class="tab-content">
                        <!-- Tab Thông tin cá nhân -->
                        <div
                          class="tab-pane fade active show"
                          id="profile"
                          role="tabpanel"
                          aria-labelledby="profile-tab"
                        >
                          <form
                            th:action="@{/student/profile/update}"
                            method="post"
                            th:object="${user}"
                            enctype="multipart/form-data"
                            class="rbt-profile-row rbt-default-form row row--15"
                          >
                            <div class="rbt-dashboard-content-wrapper">
                              <div
                                class="tutor-bg-photo height-350"
                                style="
                                  background-image: url('/assets/images/bg/background-student.jpg');
                                  background-size: cover;
                                  background-position: center;
                                "
                                sec:authorize="hasRole('ROLE_STUDENT') and not hasAnyRole('ROLE_INSTRUCTOR', 'ROLE_ADMIN')"
                              ></div>

                              <div
                                class="tutor-bg-photo height-350"
                                style="
                                  background-image: url('/assets/images/bg/bg-image-5.jpg');
                                  background-size: cover;
                                  background-position: center;
                                "
                                sec:authorize="hasAnyRole('ROLE_INSTRUCTOR', 'ROLE_ADMIN')"
                              ></div>

                              <!-- Start Tutor Information  -->
                              <div class="rbt-tutor-information">
                                <div class="rbt-tutor-information-left">
                                  <div class="thumbnail rbt-avatars size-lg position-relative">
                                    <img
                                      id="previewImage"
                                      th:src="@{'/uploads/users/' + ${user.image}}"
                                      onerror="this.onerror=null; this.src='/assets/images/team/user-icon.png';"
                                      alt="Avatar"
                                    />
                                    <div class="rbt-edit-photo-inner">
                                      <button
                                        class="rbt-edit-photo"
                                        id="uploadTrigger"
                                        title="Upload Photo"
                                        type="button"
                                      >
                                        <i class="feather-camera"></i>
                                      </button>
                                      <!-- input file ẩn -->
                                      <input
                                        type="file"
                                        id="uploadInput"
                                        name="imageFile"
                                        style="display: none"
                                        accept="image/*"
                                      />
                                    </div>
                                  </div>
                                </div>
                                <div class="rbt-tutor-information-right">
                                  <div class="tutor-btn">
                                    <label
                                      for="uploadInput"
                                      class="rbt-btn btn-sm btn-border color-white radius-round-10"
                                      style="cursor: pointer"
                                    >
                                      Chỉnh sửa ảnh đại diện
                                    </label>
                                  </div>
                                </div>
                              </div>
                              <!-- End Tutor Information  -->
                            </div>
                            <div class="col-lg-6 col-md-6 col-sm-6 col-12">
                              <div class="rbt-form-group">
                                <label for="fullname">Họ tên</label>
                                <input id="fullname" type="text" th:field="*{fullname}" placeholder="Họ tên" required />
                                <div
                                  th:if="${#fields.hasErrors('fullname')}"
                                  class="text-danger"
                                  th:errors="*{fullname}"
                                ></div>
                              </div>
                            </div>
                            <div class="col-lg-6 col-md-6 col-sm-6 col-12">
                              <div class="rbt-form-group">
                                <label for="email">Email</label>
                                <input id="email" type="email" th:field="*{email}" placeholder="Email" readonly />
                              </div>
                            </div>
                            <div class="col-lg-6 col-md-6 col-sm-6 col-12">
                              <div class="rbt-form-group">
                                <label for="phonenumber">Số điện thoại</label>
                                <input
                                  id="phonenumber"
                                  type="text"
                                  th:field="*{phoneNumber}"
                                  placeholder="Số điện thoại"
                                />
                              </div>
                            </div>
                            <div class="col-lg-6 col-md-6 col-sm-6 col-12">
                              <div class="rbt-form-group">
                                <label for="occupation">Nghề nghiệp/Kỹ năng</label>
                                <input
                                  id="occupation"
                                  type="text"
                                  th:field="*{occupation}"
                                  placeholder="Nghề nghiệp/Kỹ năng"
                                />
                              </div>
                            </div>
                            <div class="col-12">
                              <div class="rbt-form-group">
                                <label for="bio">Tiểu sử</label>
                                <textarea
                                  id="bio"
                                  cols="20"
                                  rows="5"
                                  th:field="*{biography}"
                                  placeholder="Tiểu sử"
                                ></textarea>
                              </div>
                            </div>
                            <div class="col-12 mt--20">
                              <div class="rbt-form-group">
                                <button type="submit" class="rbt-btn btn-gradient">Lưu thay đổi</button>
                              </div>
                            </div>
                          </form>
                        </div>

                        <!-- Tab Đổi mật khẩu -->
                        <div class="tab-pane fade" id="password" role="tabpanel" aria-labelledby="password-tab">
                          <form
                            th:action="@{/student/change-password}"
                            method="post"
                            class="rbt-profile-row rbt-default-form row row--15"
                          >
                            <div class="col-12">
                              <div class="rbt-form-group">
                                <label for="currentpassword">Mật khẩu hiện tại</label>
                                <input
                                  id="currentpassword"
                                  type="password"
                                  name="currentPassword"
                                  placeholder="Mật khẩu hiện tại"
                                  required
                                />
                              </div>
                            </div>
                            <div class="col-12">
                              <div class="rbt-form-group">
                                <label for="newpassword">Mật khẩu mới</label>
                                <input
                                  id="newpassword"
                                  type="password"
                                  name="newPassword"
                                  placeholder="Mật khẩu mới"
                                  required
                                />
                              </div>
                            </div>
                            <div class="col-12">
                              <div class="rbt-form-group">
                                <label for="retypenewpassword">Nhập lại mật khẩu mới</label>
                                <input
                                  id="retypenewpassword"
                                  type="password"
                                  name="confirmPassword"
                                  placeholder="Nhập lại mật khẩu mới"
                                  required
                                />
                              </div>
                            </div>
                            <div class="col-12 mt--10">
                              <div class="rbt-form-group">
                                <button type="submit" class="rbt-btn btn-gradient">Cập nhật mật khẩu</button>
                              </div>
                            </div>
                          </form>
                        </div>
                      </div>
                    </div>
                  </div>
                  <!-- End Instructor Profile  -->
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- End Card Style -->
    </div>

    <th:block th:fragment="scripts">
      <script>
        // Khi nhấn nút (hoặc icon) sẽ mở hộp chọn file
        document.getElementById("uploadTrigger").addEventListener("click", function () {
          document.getElementById("uploadInput").click();
        });

        // Khi chọn file thì hiển thị preview
        document.getElementById("uploadInput").addEventListener("change", function (event) {
          const file = event.target.files[0];
          if (file && file.type.startsWith("image/")) {
            const reader = new FileReader();
            reader.onload = function (e) {
              document.getElementById("previewImage").src = e.target.result;
            };
            reader.readAsDataURL(file);
          }
        });
      </script>
    </th:block>
  </body>
</html>
